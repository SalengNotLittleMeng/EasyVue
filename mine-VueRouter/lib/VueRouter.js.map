{"version":3,"file":"VueRouter.js","sources":["../src/install.js","../src/create-routesMap.js","../src/create-matcher.js","../src/history/base.js","../src/history/history.js","../src/history/hash.js","../src/index.js"],"sourcesContent":["export let Vue;\nexport function install(_Vue) {\n  Vue = _Vue;\n  Vue.mixin({\n    beforeCreate() {\n      // 这里不用原型继承的原因是因为会导致所有的Vue类共享路由\n      if (this.$options.router) {\n        // 根实例上传递了router\n        this._routerRoot = this;\n        this._router = this.$options.router || {};\n        this._router.init(this); //this就是我们整个的应用(new Vue)\n      } else {\n        // 所有组件上都增加一个routerRoot的指针指向根实例\n        this._routerRoot = this.$parent?._router;\n      }\n    },\n  });\n  // 劫持$router属性，取$router其实是取了根实例上的router\n  Object.defineProperty(Vue.prototype, \"$router\", {\n    get() {\n      return this._routerRoot;\n    },\n  });\n  Vue.component(\"router-link\", {\n    props: {\n      to: { type: String },\n      tag: { type: String, default: \"a\" },\n    },\n    methods: {\n      handler() {\n        this.$router.push(this.to);\n      },\n    },\n    render(h) {\n      let tag = this.tag;\n      return h(\n        tag,\n        {\n          on: {\n            click: () => {\n              this.handler();\n            },\n          },\n        },\n        [this.$slots.default]\n      );\n    },\n  });\n  Vue.component(\"router-view\", {\n    render(h) {\n      return h(\"a\", { class: \"foo\" }, [\"hello\"]);\n    },\n  });\n}\n","export default function createRouteMap(routes, pathMap = {}) {\n  // 根据用户选项扁平化信息,将深度子类转化为扁平层级\n  routes.forEach((route) => {\n    addRouteRecord(route, pathMap);\n  });\n  return {\n    pathMap,\n  };\n}\nfunction addRouteRecord(route, pathMap, parentRecord) {\n  let path = parentRecord\n    ? `${parentRecord.path == \"/\" ? \"\" : \"/\"}${route.path}`\n    : route.path;\n  if (!pathMap[path]) {\n    pathMap[path] = {\n      path,\n      component: route.component,\n      props: route.props,\n      meta: route.meta,\n    };\n  }\n  route.children &&\n    route.children.forEach((children) => {\n      addRouteRecord(children, pathMap);\n    });\n}\n","import createRouteMap from \"./create-routesMap\";\nexport default function createMatcher(routes) {\n  let { pathMap } = createRouteMap(routes);\n  function addRoutes(routes) {\n    // 动态添加路由\n    createRouteMap(routes, pathMap);\n  }\n  function addRoute(route) {\n    createRouteMap([route], pathMap);\n  }\n  function match(location) {\n    return pathMap[location];\n  }\n  return {\n    addRoutes, //添加多个路由\n    addRoute, //添加一个路由\n    match, //给一个路径来返回路由\n  };\n}\n","export default class Base {\n  constructor(router) {\n    this.router = router;\n  }\n  // 所有跳转的逻辑都要放在transitionTo中来实现\n  transitionTo(location, listener) {\n    // 用之前的匹配方法\n    let record = this.router.match(location);\n    console.log(record);\n    // 当路由切换的时候，也应该调用transitionTo拿到新的记录\n    listener && listener();\n  }\n}\n","import Base from \"./base\";\nclass History extends Base {\n  constructor(router) {\n    super(router);\n  }\n  setupListener() {\n    window.addEventListener(\"popstate\", function () {\n      console.log(this.window.location.pathname);\n    });\n  }\n  getCurrentLocation() {\n    return window.location.pathname;\n  }\n}\n\nexport default History;\n","import Base from \"./base\";\nfunction ensureSlash() {\n  if (window.location.hash) {\n    return;\n  }\n  window.location.hash = \"/\";\n}\nfunction getHash() {\n  // 截取，获取真正的hash值\n  return window.location.hash.slice(1);\n}\nclass Hash extends Base {\n  constructor(router) {\n    super(router);\n    // 初始化哈希路由的时候要给定默认的哈希路径\n    ensureSlash();\n  }\n  // 之后需要调用此方法，监控hash值的变化\n  setupListener() {\n    window.addEventListener(\"hashchange\", function () {\n      console.log(getHash());\n    });\n  }\n  getCurrentLocation() {\n    return getHash();\n  }\n}\nexport default Hash;\n","import { install, Vue } from \"./install\";\nimport createMatcher from \"./create-matcher\";\nimport History from \"./history/history\";\nimport Hash from \"./history/hash\";\nclass VueRouter {\n  constructor(options) {\n    this.install = install;\n    // 对用户传入的路由表进行映射\n    const routes = options.routes;\n    this.matcher = createMatcher(routes);\n    // 根据不用的模式创建不同的路由系统\n    let mode = options.mode || \"hash\";\n    if (mode == \"hash\") {\n      this.history = new Hash(this);\n    } else if (mode == \"history\") {\n      this.history = new History(this);\n    }\n  }\n  match(path) {\n    return this.matcher.match(path);\n  }\n  push(location) {\n    this.history.transitionTo(location);\n  }\n  init(app) {\n    let history = this.history;\n    // 根据路径变化，匹配不同的组件进行渲染，路径变化，更新视图，路径需要是响应式的\n    history.transitionTo(history.getCurrentLocation(), () => {\n      history.setupListener(); //监听路由变化\n    });\n  }\n}\nexport default VueRouter;\n"],"names":["Vue","install","_Vue","mixin","beforeCreate","$options","router","_routerRoot","_router","init","$parent","Object","defineProperty","prototype","get","component","props","to","type","String","tag","methods","handler","$router","push","render","h","on","click","$slots","createRouteMap","routes","pathMap","forEach","route","addRouteRecord","parentRecord","path","meta","children","createMatcher","addRoutes","addRoute","match","location","Base","listener","record","console","log","History","window","addEventListener","pathname","ensureSlash","hash","getHash","slice","Hash","VueRouter","options","matcher","mode","history","transitionTo","app","getCurrentLocation","setupListener"],"mappings":"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"}