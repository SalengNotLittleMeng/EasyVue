{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["// 我们希望保留原数组特性并重写部分数组方法\nlet oldArrayProto = Array.prototype;\nexport let newArrayProto = Object.create(oldArrayProto);\n// 所有变异方法\nconst methods = [\n  \"push\",\n  \"shift\",\n  \"unshift\",\n  \"splice\",\n  \"pop\",\n  \"reverse\",\n  \"sort\",\n];\nmethods.forEach((method) => {\n  newArrayProto[method] = function (...args) {\n    // 内部调用原来的方法\n    const result = oldArrayProto[method].call(this, ...args);\n    let ob = this.__ob__;\n    // 将数组中新增的方法进行响应式劫持\n    let inserted;\n    switch (method) {\n      case \"push\":\n      case \"unshift\":\n        inserted = args;\n        break;\n      case \"splice\":\n        inserted = args.slice(2);\n      default:\n        break;\n    }\n    if (inserted) {\n      ob.observeArray(inserted);\n    }\n    return result;\n  };\n});\n","import { newArrayProto } from \"./array\";\nclass Observe {\n  constructor(data) {\n    // 给数据添加一个表示__ob__,被标识的数据标识已经被观测过了\n    //data.__ob__=this 直接将this添加到__ob__后，会导致遍历可观测对象时遍历到this，形成死循环\n    // 添加属性__ob__并将这个属性设置为不可枚举，使其在遍历时无法被遍历\n    Object.defineProperty(data, \"__ob__\", {\n      value: this,\n      enumerable: false,\n    });\n    if (Array.isArray(data)) {\n      // 用户一般不会通过索引调用数组的值，直接遍历又会导致性能问题\n      //因此我们可以通过重写数组7个变异方法的方式来监控数据变化\n      //同时应该考虑数组中对象的劫持\n      data.__proto__ = newArrayProto;\n      this.observeArray(data); //监控数组中的对象,只将数组中的对象进行挂载\n    } else {\n      this.walk(data);\n    }\n    // Object.defineProperty只能劫持已经存在的属性l\n  }\n  walk(data) {\n    //循环对象，对属性依次劫持,重新定义属性\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key]);\n    });\n  }\n  observeArray(data) {\n    data.forEach((item) => {\n      observe(item);\n    });\n  }\n}\nexport function defineReactive(target, key, value) {\n  // 闭包，从外部拿到value\n  // 如果劫持到的属性依然是一个对象，就应该递归劫持所有属性，深度属性劫持\n  observe(value);\n  Object.defineProperty(target, key, {\n    get() {\n      console.log(\"用户取值了\", value);\n      return value;\n    },\n    set(newValue) {\n      console.log(\"用户修改值了\", newValue);\n      if (newValue == value) return;\n      value = newValue;\n    },\n  });\n}\nexport function observe(data) {\n  if (typeof data != \"object\" || data == null) {\n    return; //只对对象进行劫持\n  }\n  //判断对象是否被劫持过，需要用一个实例来观测判断\n\n  return new Observe(data);\n}\n","import { observe } from \"./observe/index\";\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.data) {\n    initData(vm);\n  }\n}\nfunction proxy(vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[target][key];\n    },\n    set(newValue) {\n      vm[target][key] = newValue;\n    },\n  });\n}\nfunction initData(vm) {\n  let { data } = vm.$options;\n  data = typeof data == \"function\" ? data.call(vm) : data;\n  vm._data = data;\n  observe(data);\n  for (let key in data) {\n    proxy(vm, \"_data\", key);\n  }\n}\n","const ncname=`[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\nconst qnameCapture=`((?:${ncname}\\\\:)?${ncname})`;\nconst startTagOpen=new RegExp(`^<${qnameCapture}`)\nconst endTag=new RegExp(`^<\\\\/${qnameCapture}[^>]>*>`)\nconst attribute=/^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>']+)))?/\nconst startTagClose=/^\\s*(\\/?)>/\nconst defaultTagRE=/\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\n\nexport function complieToFunction(template) {\nconsole.log(template)\n}o9\n","// 给Vue增加初始化方法\nimport { initState } from \"./state\";\nimport { complieToFunction } from \"./compiler/index\";\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n    initState(vm);\n    if (options.el) {\n      vm.$mount(options.el);\n    }\n  };\n  Vue.prototype.$mount = function (el) {\n    const vm = this;\n    el = document.querySelector(el);\n    let opts = vm.$options;\n    console.log(opts);\n    // 当没有render函数时\n    if (!opts?.render) {\n      let template = null;\n      // 没有模板但写了el\n      if (!opts.template && opts.el) {\n        template = el.outerHTML;\n        // 存在模板或不存在模板和el\n      } else {\n        // 存在模板\n        if (opts.template) {\n          template = opts.template;\n        } else {\n          // 既没有模板也没有el\n          template = \"<div></div>\";\n        }\n      }\n      //拿到模板\n      // 获取优先级：render=>temple=>el\n      if (template) {\n        const render = complieToFunction(template);\n        opts.render = render;\n      }\n    }\n  };\n}\n// script标签引入的vue，编译过程在浏览器\n// runtime是不包含编译的，编译时通过loader进行转译.vue文件，用runtime不能使用template(在mian.js中，.vue文件有loader转译，因此不影响)\n// 包含main.js中模板编译的版本是runtime-with-compiler\n","import { initMixin } from \"./init\";\nfunction Vue(options) {\n  this._init(options);\n}\n// 扩展了init方法\ninitMixin(Vue);\nexport default Vue;\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","ob","__ob__","inserted","slice","observeArray","Observe","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","console","log","set","newValue","initState","vm","opts","$options","initData","proxy","_data","complieToFunction","template","o9","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACA,IAAIA,aAAa,GAAGC,KAAK,CAACC,SAA1B,CAAA;EACO,IAAIC,aAAa,GAAGC,MAAM,CAACC,MAAP,CAAcL,aAAd,CAApB;;EAEP,IAAMM,OAAO,GAAG,CACd,MADc,EAEd,OAFc,EAGd,SAHc,EAId,QAJc,EAKd,KALc,EAMd,SANc,EAOd,MAPc,CAAhB,CAAA;EASAA,OAAO,CAACC,OAAR,CAAgB,UAACC,MAAD,EAAY;EAC1BL,EAAAA,aAAa,CAACK,MAAD,CAAb,GAAwB,YAAmB;EAAA,IAAA,IAAA,qBAAA,CAAA;;EAAA,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAANC,IAAM,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;QAANA,IAAM,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;EAAA,KAAA;;EACzC;EACA,IAAA,IAAMC,MAAM,GAAG,CAAAV,qBAAAA,GAAAA,aAAa,CAACQ,MAAD,CAAb,EAAsBG,IAAtB,CAAA,KAAA,CAAA,qBAAA,EAAA,CAA2B,IAA3B,CAAA,CAAA,MAAA,CAAoCF,IAApC,CAAf,CAAA,CAAA;;EACA,IAAA,IAAIG,EAAE,GAAG,IAAKC,CAAAA,MAAd,CAHyC;;EAKzC,IAAA,IAAIC,QAAJ,CAAA;;EACA,IAAA,QAAQN,MAAR;EACE,MAAA,KAAK,MAAL,CAAA;EACA,MAAA,KAAK,SAAL;EACEM,QAAAA,QAAQ,GAAGL,IAAX,CAAA;EACA,QAAA,MAAA;;EACF,MAAA,KAAK,QAAL;EACEK,QAAAA,QAAQ,GAAGL,IAAI,CAACM,KAAL,CAAW,CAAX,CAAX,CAAA;EANJ,KAAA;;EAUA,IAAA,IAAID,QAAJ,EAAc;QACZF,EAAE,CAACI,YAAH,CAAgBF,QAAhB,CAAA,CAAA;EACD,KAAA;;EACD,IAAA,OAAOJ,MAAP,CAAA;KAnBF,CAAA;EAqBD,CAtBD,CAAA;;MCZMO;EACJ,EAAA,SAAA,OAAA,CAAYC,IAAZ,EAAkB;EAAA,IAAA,eAAA,CAAA,IAAA,EAAA,OAAA,CAAA,CAAA;;EAChB;EACA;EACA;EACAd,IAAAA,MAAM,CAACe,cAAP,CAAsBD,IAAtB,EAA4B,QAA5B,EAAsC;EACpCE,MAAAA,KAAK,EAAE,IAD6B;EAEpCC,MAAAA,UAAU,EAAE,KAAA;OAFd,CAAA,CAAA;;EAIA,IAAA,IAAIpB,KAAK,CAACqB,OAAN,CAAcJ,IAAd,CAAJ,EAAyB;EACvB;EACA;EACA;QACAA,IAAI,CAACK,SAAL,GAAiBpB,aAAjB,CAAA;EACA,MAAA,IAAA,CAAKa,YAAL,CAAkBE,IAAlB,CAAA,CALuB;EAMxB,KAND,MAMO;QACL,IAAKM,CAAAA,IAAL,CAAUN,IAAV,CAAA,CAAA;EACD,KAhBe;;EAkBjB,GAAA;;;;EACD,IAAA,KAAA,EAAA,SAAA,IAAA,CAAKA,IAAL,EAAW;EACT;QACAd,MAAM,CAACqB,IAAP,CAAYP,IAAZ,EAAkBX,OAAlB,CAA0B,UAACmB,GAAD,EAAS;UACjCC,cAAc,CAACT,IAAD,EAAOQ,GAAP,EAAYR,IAAI,CAACQ,GAAD,CAAhB,CAAd,CAAA;SADF,CAAA,CAAA;EAGD,KAAA;;;EACD,IAAA,KAAA,EAAA,SAAA,YAAA,CAAaR,IAAb,EAAmB;EACjBA,MAAAA,IAAI,CAACX,OAAL,CAAa,UAACqB,IAAD,EAAU;UACrBC,OAAO,CAACD,IAAD,CAAP,CAAA;SADF,CAAA,CAAA;EAGD,KAAA;;;;;;EAEI,SAASD,cAAT,CAAwBG,MAAxB,EAAgCJ,GAAhC,EAAqCN,KAArC,EAA4C;EACjD;EACA;IACAS,OAAO,CAACT,KAAD,CAAP,CAAA;EACAhB,EAAAA,MAAM,CAACe,cAAP,CAAsBW,MAAtB,EAA8BJ,GAA9B,EAAmC;EACjCK,IAAAA,GADiC,EAC3B,SAAA,GAAA,GAAA;EACJC,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBb,KAArB,CAAA,CAAA;EACA,MAAA,OAAOA,KAAP,CAAA;OAH+B;MAKjCc,GALiC,EAAA,SAAA,GAAA,CAK7BC,QAL6B,EAKnB;EACZH,MAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBE,QAAtB,CAAA,CAAA;QACA,IAAIA,QAAQ,IAAIf,KAAhB,EAAuB,OAAA;EACvBA,MAAAA,KAAK,GAAGe,QAAR,CAAA;EACD,KAAA;KATH,CAAA,CAAA;EAWD,CAAA;EACM,SAASN,OAAT,CAAiBX,IAAjB,EAAuB;IAC5B,IAAI,OAAA,CAAOA,IAAP,CAAe,IAAA,QAAf,IAA2BA,IAAI,IAAI,IAAvC,EAA6C;EAC3C,IAAA,OAD2C;EAE5C,GAH2B;;;EAM5B,EAAA,OAAO,IAAID,OAAJ,CAAYC,IAAZ,CAAP,CAAA;EACD;;ECvDM,SAASkB,SAAT,CAAmBC,EAAnB,EAAuB;EAC5B,EAAA,IAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAAA;;IACA,IAAID,IAAI,CAACpB,IAAT,EAAe;MACbsB,QAAQ,CAACH,EAAD,CAAR,CAAA;EACD,GAAA;EACF,CAAA;;EACD,SAASI,KAAT,CAAeJ,EAAf,EAAmBP,MAAnB,EAA2BJ,GAA3B,EAAgC;EAC9BtB,EAAAA,MAAM,CAACe,cAAP,CAAsBkB,EAAtB,EAA0BX,GAA1B,EAA+B;EAC7BK,IAAAA,GAD6B,EACvB,SAAA,GAAA,GAAA;EACJ,MAAA,OAAOM,EAAE,CAACP,MAAD,CAAF,CAAWJ,GAAX,CAAP,CAAA;OAF2B;MAI7BQ,GAJ6B,EAAA,SAAA,GAAA,CAIzBC,QAJyB,EAIf;EACZE,MAAAA,EAAE,CAACP,MAAD,CAAF,CAAWJ,GAAX,IAAkBS,QAAlB,CAAA;EACD,KAAA;KANH,CAAA,CAAA;EAQD,CAAA;;EACD,SAASK,QAAT,CAAkBH,EAAlB,EAAsB;EACpB,EAAA,IAAMnB,IAAN,GAAemB,EAAE,CAACE,QAAlB,CAAMrB,IAAN,CAAA;EACAA,EAAAA,IAAI,GAAG,OAAOA,IAAP,IAAe,UAAf,GAA4BA,IAAI,CAACP,IAAL,CAAU0B,EAAV,CAA5B,GAA4CnB,IAAnD,CAAA;IACAmB,EAAE,CAACK,KAAH,GAAWxB,IAAX,CAAA;IACAW,OAAO,CAACX,IAAD,CAAP,CAAA;;EACA,EAAA,KAAK,IAAIQ,GAAT,IAAgBR,IAAhB,EAAsB;EACpBuB,IAAAA,KAAK,CAACJ,EAAD,EAAK,OAAL,EAAcX,GAAd,CAAL,CAAA;EACD,GAAA;EACF;;ECjBM,SAASiB,iBAAT,CAA2BC,QAA3B,EAAqC;IAC5CZ,OAAO,CAACC,GAAR,CAAYW,QAAZ,CAAA,CAAA;EACC,CAAA;EAAAC,EAAE;;ECVH;EAGO,SAASC,SAAT,CAAmBC,GAAnB,EAAwB;EAC7BA,EAAAA,GAAG,CAAC7C,SAAJ,CAAc8C,KAAd,GAAsB,UAAUC,OAAV,EAAmB;MACvC,IAAMZ,EAAE,GAAG,IAAX,CAAA;MACAA,EAAE,CAACE,QAAH,GAAcU,OAAd,CAAA;MACAb,SAAS,CAACC,EAAD,CAAT,CAAA;;MACA,IAAIY,OAAO,CAACC,EAAZ,EAAgB;EACdb,MAAAA,EAAE,CAACc,MAAH,CAAUF,OAAO,CAACC,EAAlB,CAAA,CAAA;EACD,KAAA;KANH,CAAA;;EAQAH,EAAAA,GAAG,CAAC7C,SAAJ,CAAciD,MAAd,GAAuB,UAAUD,EAAV,EAAc;MACnC,IAAMb,EAAE,GAAG,IAAX,CAAA;EACAa,IAAAA,EAAE,GAAGE,QAAQ,CAACC,aAAT,CAAuBH,EAAvB,CAAL,CAAA;EACA,IAAA,IAAIZ,IAAI,GAAGD,EAAE,CAACE,QAAd,CAAA;EACAP,IAAAA,OAAO,CAACC,GAAR,CAAYK,IAAZ,EAJmC;;MAMnC,IAAI,EAACA,IAAD,KAACA,IAAAA,IAAAA,IAAD,eAACA,IAAI,CAAEgB,MAAP,CAAJ,EAAmB;EACjB,MAAA,IAAIV,QAAQ,GAAG,IAAf,CADiB;;QAGjB,IAAI,CAACN,IAAI,CAACM,QAAN,IAAkBN,IAAI,CAACY,EAA3B,EAA+B;EAC7BN,QAAAA,QAAQ,GAAGM,EAAE,CAACK,SAAd,CAD6B;EAG9B,OAHD,MAGO;EACL;UACA,IAAIjB,IAAI,CAACM,QAAT,EAAmB;YACjBA,QAAQ,GAAGN,IAAI,CAACM,QAAhB,CAAA;EACD,SAFD,MAEO;EACL;EACAA,UAAAA,QAAQ,GAAG,aAAX,CAAA;EACD,SAAA;EACF,OAdgB;EAgBjB;;;EACA,MAAA,IAAIA,QAAJ,EAAc;EACZ,QAAA,IAAMU,MAAM,GAAGX,iBAAiB,CAACC,QAAD,CAAhC,CAAA;UACAN,IAAI,CAACgB,MAAL,GAAcA,MAAd,CAAA;EACD,OAAA;EACF,KAAA;KA3BH,CAAA;EA6BD;EAED;EACA;;EC3CA,SAASP,GAAT,CAAaE,OAAb,EAAsB;IACpB,IAAKD,CAAAA,KAAL,CAAWC,OAAX,CAAA,CAAA;EACD;;;EAEDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}