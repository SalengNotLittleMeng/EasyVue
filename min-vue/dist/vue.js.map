{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 我们希望保留原数组特性并重写部分数组方法\r\nlet oldArrayProto=Array.prototype\r\nexport let newArrayProto=Object.create(oldArrayProto);\r\n// 所有变异方法\r\nconst methods=[\r\n'push',\r\n'shift',\r\n'unshift',\r\n'splice',\r\n'pop',\r\n'reverse',\r\n'sort'\r\n]\r\nmethods.forEach(method=>{\r\nnewArrayProto[method]=function(...args){\r\n// 内部调用原来的方法\r\n  const result=oldArrayProto[method].call(this,...args)\r\n let ob=this.__ob__\r\n// 将数组中新增的方法进行响应式劫持\r\n   let inserted\r\n    switch(method){\r\n        case \"push\":\r\n        case \"unshift\":\r\n        inserted=args;\r\n        break;\r\n        case \"splice\":\r\n        inserted=args.slice(2);\r\n        default:\r\n        break;\r\n    }\r\n    if(inserted){\r\n        ob.observeArray(inserted)\r\n    }\r\n  return result\r\n}\r\n}) \r\n","import {newArrayProto} from './array'\nclass Observe {\n  constructor(data) {\n// 给数据添加一个表示__ob__,被标识的数据标识已经被观测过了\n     //data.__ob__=this 直接将this添加到__ob__后，会导致遍历可观测对象时遍历到this，形成死循环\n// 添加属性__ob__并将这个属性设置为不可枚举，使其在遍历时无法被遍历\n        Object.defineProperty(data,\"__ob__\",{\n        value:this,\n        enumerable:false\n    })\n    if(Array.isArray(data)){\n        // 用户一般不会通过索引调用数组的值，直接遍历又会导致性能问题\n        //因此我们可以通过重写数组7个变异方法的方式来监控数据变化\n        //同时应该考虑数组中对象的劫持\n        data.__proto__=newArrayProto\n        this.observeArray(data)  //监控数组中的对象,只将数组中的对象进行挂载\n    }else{\n        this.walk(data);\n    }\n    // Object.defineProperty只能劫持已经存在的属性l\n  }\n  walk(data) {\n    //循环对象，对属性依次劫持,重新定义属性\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key]);\n    });\n  }\n  observeArray(data){\n    data.forEach(item=>{\n        observe(item)\n    })\n    }\n}\nexport function defineReactive(target, key, value) {\n  // 闭包，从外部拿到value\n  // 如果劫持到的属性依然是一个对象，就应该递归劫持所有属性，深度属性劫持\n  observe(value);\n  Object.defineProperty(target, key, {\n    get() {\n      console.log(\"用户取值了\", value);\n      return value;\n    },\n    set(newValue) {\n     console.log(\"用户修改值了\", newValue);\n      if (newValue == value) return;\n      value = newValue;\n    },\n  });\n}\nexport function observe(data) {\n  if (typeof data != \"object\" || data == null) {\n    return; //只对对象进行劫持\n  }\n  //判断对象是否被劫持过，需要用一个实例来观测判断\n\n  return new Observe(data);\n}\n","import { observe } from \"./observe/index\";\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.data) {\n    initData(vm);\n  }\n}\nfunction proxy(vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[target][key];\n    },\n    set(newValue) {\n      vm[target][key] = newValue;\n    },\n  });\n}\nfunction initData(vm) {\n  let { data } = vm.$options;\n  data = typeof data == \"function\" ? data.call(vm) : data;\n  vm._data = data;\n  observe(data);\n  for (let key in data) {\n    proxy(vm, \"_data\", key);\n  }\n}\n","// 给Vue增加初始化方法\nimport { initState } from \"./state\";\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n    initState(vm);\n  };\n}\n","import { initMixin } from \"./init\";\nfunction Vue(options) {\n  this._init(options);\n}\n// 扩展了init方法\ninitMixin(Vue);\nexport default Vue;\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","ob","__ob__","inserted","slice","observeArray","Observe","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","console","log","set","newValue","initState","vm","opts","$options","initData","proxy","_data","initMixin","Vue","_init","options"],"mappings":"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"}